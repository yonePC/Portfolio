<h1>投稿詳細</h1>

<table class= "table">
  <thead>
    <tr>
      <th></th>
      <th>社員番号</th>
      <th>名前</th>
      <th>実施エリア</th>
      <th>タグ</th>
      <th>内容</th>
      <th></th>
      <th></th>
    </tr>
  <thead>

  <tbody>
    <td>
      <%= @post.datetime %>
    </td>

    <td>
      <%= @post.user.number %>
    </td>

    <td>
      <%= @post.user.name %>
    </td>

    <td>
      <%= @post.area %>
    </td>

    <td>
      <% @post.tags.each do |tag| %>
        <%= tag.name %>
      <% end %>
    </td>

    <td>
      <%= @post.body %>
    </td>

    <!--スタンプ-->
    <td>
      <% if @post.stamped_by?(current_user) %>
        <%= link_to post_stamps_path(@post), method: :delete, class: "fas fa-check-square fa-2x check_gleen" do %>
        <% end %>
        (<%= @post.stamps.count %>)
      <% else %>
        <%= link_to post_stamps_path(@post), method: :post, class: "far fa-square fa-2x" do %>
        <% end %>
        (<%= @post.stamps.count %>)
      <% end %>
    </td>
    <!--コメントの編集/削除-->
    <td>
      <%= link_to "編集", edit_post_path(@post) %>
      <%= link_to "削除", post_path(@post), method: :delete, data: {confirm: "削除しますか？"} %>
    </td>
  </tbody>

</table>

<!--コメント一覧-->
<h3>コメント(<%= @post.comments.count %>)</h3>
<table class= "table">

  <% @post.comments.each do |comment| %>
  <tr>
  <td>
      <%= comment.user.name %>
  </td>

  <td>
    <%= comment.body %>
      <% if current_user == comment.user %>
      	<td><%= link_to "削除", post_comment_path(comment.post_id, comment.id), data: {confirm: "このコメントを削除しますか？"}, class: "btn-sm btn-danger", method: :delete %></td>
    	<% end %>
  </td>
  <!--星評価表示-->
  <td>
    <div id="comment-rate-<%= comment.id %>"></div>
        <script>
          $('#comment-rate-<%= comment.id %>').raty({
            size:  60,
            starOff:  '<%= asset_path('star-off.png') %>',
            starOn : '<%= asset_path('star-on.png') %>',
            starHalf: '<%= asset_path('star-half.png') %>',
            half: true,
            readOnly: true,
            score: <%= comment.rate %>,
          });
        </script>
  </td>

  </tr>
  <% end %>
  </table>
<!--コメント投稿-->
  <%= form_with model:[@post,@comment], local: true do |f| %>
    <%= f.text_area :body, size:"90x5" %><br>
<!--星評価投稿-->
    <div id= "rate-form", class="rate-form" >
      <%= f.label :rate,"評価" %>
      <%= f.hidden_field :rate, id: :review_star %>
    </div>
    <div>"<span id="hint1"></span>"</div>

    <%= f.submit "コメントを投稿"%>
  <% end %>

    <script>
      $('#rate-form').raty({

          starOn: '<%= asset_path('star-on.png') %>',
          starOff: '<%= asset_path('star-off.png') %>',
          starHalf: '<%= asset_path('star-half.png') %>',
          scoreName: 'comment[rate]',
          half: true,
          target: '#hint1',
          hints: ["とても悪い", "悪い", "まあまあ", "良い", "とても良い"],
      });
    </script>

